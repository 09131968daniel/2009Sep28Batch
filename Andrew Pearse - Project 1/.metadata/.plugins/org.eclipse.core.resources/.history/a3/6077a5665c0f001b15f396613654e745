package com.photoshop.repo;

import java.sql.Connection;
import java.sql.PreparedStatement;
import java.sql.ResultSet;
import java.sql.SQLException;
import java.util.LinkedList;
import java.util.List;

import com.photoshop.model.Reimbursement;
import com.photoshop.model.ReimbursementStatus;
import com.photoshop.model.ReimbursementType;
import com.photoshop.model.User;
import com.photoshop.model.UserRole;
import com.photoshop.util.ConnectionUtil;

public class ReimbursementDao implements DaoContract<Reimbursement, Integer> {

	private static UserDao ud;
	
	public ReimbursementDao() {
		this(new UserDao());
	}
	
	public ReimbursementDao(UserDao ud) {
		this.ud = ud;
	}
	
	@Override
	public List<Reimbursement> findAll() {
		List<Reimbursement> reimbursements = new LinkedList<>();
		String sql = "select * from get_all_reimbursements";
		
		try (Connection conn = ConnectionUtil.getInstance().getConnection() ){
			PreparedStatement ps = conn.prepareStatement(sql);
			ResultSet rs = ps.executeQuery();
			
			while(rs.next()) {
				reimbursements.add(new Reimbursement(rs.getInt("id"), rs.getFloat("amount"), rs.getTimestamp("submitted"), rs.getTimestamp("resolved"), 
										rs.getString("description"), rs.getString("receipt"), 
										ud.findById(rs.getInt("author")), ud.findById(rs.getInt("resolver")), 
										new ReimbursementStatus(0, rs.getString("status")), 
										new ReimbursementType(0, rs.getString("type"))));
			}
			
			
		} catch (SQLException e) {
			e.printStackTrace();
		}
		
		return reimbursements;
	}

	@Override
	public Reimbursement findById(Integer i) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public int create(Reimbursement t) {
		// TODO Auto-generated method stub
		return 0;
	}

	@Override
	public int update(Reimbursement t) {
		// TODO Auto-generated method stub
		return 0;
	}

}
